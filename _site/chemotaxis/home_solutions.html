<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Solutions - Xu lab@CBD_SCS_CMU</title>
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Xu lab@CBD_SCS_CMU">
<meta property="og:title" content="Solutions">
<meta property="og:url" content="http://localhost:4000/chemotaxis/home_solutions">


  <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.">












<link rel="canonical" href="http://localhost:4000/chemotaxis/home_solutions">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->



<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Xu lab@CBD_SCS_CMU</a>
        <ul class="visible-links">
                
                
                    <li class="masthead__menu-item">
                        <a href="/news/">NEWS</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/papers/">PAPERS</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/group/">GROUP</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/meet-the-team/">ABOUT MIN XU</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/position/">POSITION</a>
                    </li>
                
            
                
                
                    <li class="masthead__menu-item">
                        <a href="/software/">SOFTWARE</a>
                    </li>
                
            
                
                
                    <li class="dropdown ">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Take the Course    <i class="fa fa-caret-down fa-sm" aria-hidden="true"></i><span class="caret"></span></a>
                        <ul class="dropdown-content">
                            
                                <li>
                                    <a href="/prologue/">    <b>Prologue:</b> Introducing biological modeling with Turing patterns</a>
                                </li>
                            
                                <li>
                                    <a href="/motifs/home">    <b>Module 1:</b> Finding motifs in transcription factor networks</a>
                                </li>
                            
                                <li>
                                    <a href="/chemotaxis/home">    <b>Module 2:</b> Unpacking E. coli's genius exploration algorithm</a>
                                </li>
                            
                                <li>
                                    <a href="/coronavirus/home">    <b>Module 3:</b> Analyzing the coronavirus spike protein</a>
                                </li>
                            
                                <li>
                                    <a href="">    <b>Module 4:</b> coming soon!</a>
                                </li>
                            
                        </ul>
                    </li>
                
            
        </ul>
        <!--
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        -->
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">

  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Unpacking E. coli's Genius Exploration Algorithm</span>
        

        
        <ul>
          
            <li><a href="/chemotaxis/home">Introduction: Lost Immortals and chemotaxis<br><br></a></li>
          
            <li><a href="/chemotaxis/home_walk">Bacterial runs and tumbles<br><br></a></li>
          
            <li><a href="/chemotaxis/home_signal">Signaling & ligand-receptor dynamics<br><br></a></li>
          
            <li><a href="/chemotaxis/home_signalpart2">Stochastic simulation of chemical reactions<br><br></a></li>
          
            <li><a href="/chemotaxis/home_biochem">A biochemically accurate model of chemotaxis<br><br></a></li>
          
            <li><a href="/chemotaxis/home_senseadap">Methylation helps bacteria adapt to differing concentrations<br><br></a></li>
          
            <li><a href="/chemotaxis/home_gradient">Modeling a bacterium's response to an attractant gradient<br><br></a></li>
          
            <li><a href="/chemotaxis/home_conclusion">Conclusion: the beauty of E. coli's randomized exploration algorithm<br><br></a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Software Tutorials (featuring BioNetGen)</span>
        

        
        <ul>
          
            <li><a href="/chemotaxis/tutorial_lr">Getting started wtih BioNetGen and modeling ligand-receptor dynamics<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_phos">Adding phosphorylation to our BioNetGen model<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_adap">Modeling adaptation<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_gradient">Traveling up an attractant gradient<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_removal">Traveling down an attractant gradient<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_purerandom">Modeling a pure random walk strategy<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_walk">Modeling E. coli's sophisticated random walk algorithm<br><br></a></li>
          
            <li><a href="/chemotaxis/tutorial_tumbling_frequencies">Comparing different chemotaxis default tumbling frequencies</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Exercises</span>
        

        
        <ul>
          
            <li><a href="/chemotaxis/home_exercise">Exercises on Chemotaxis<br><br></a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Solutions">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Solutions
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#how-do-e-coli-respond-to-repellents">How do E. coli respond to repellents?</a></li><li><a href="#what-if-there-are-multiple-attractant-sources">What if there are multiple attractant sources?</a></li><li><a href="#is-the-actual-tumbling-reorientation-used-by-e-coli-smarter-than-our-model">Is the actual tumbling reorientation used by E. coli smarter than our model?</a></li><li><a href="#cant-get-enough-bionetgen">Canâ€™t get enough BioNetGen?</a></li><li><a href="#how-to-calculate-steady-state-concentration-in-a-reversible-bimolecular-reaction">How to calculate steady state concentration in a reversible bimolecular reaction?</a></li><li><a href="#how-to-simulate-a-reaction-step-with-the-gillespie-algorithm">How to simulate a reaction step with the Gillespie algorithm?</a></li></ul>

            </nav>
          </aside>
        
        <h2 id="how-do-e-coli-respond-to-repellents">How do <em>E. coli</em> respond to repellents?</h2>

<p><strong>Exercise 1</strong></p>

<p>In contrast to that CheY phosphorylations decrease and tumbling becomes less frequent when the cell senses higher attractant concentrations, when the cell senses more repellents there should be more frequent tumbling. The decreased tumbling frequency should be a result of increased CheY phosphorylations. The cell should always be able to adapt to the current concentrations, therefore we also expect the CheY phosphoryaltions be restored when adpating.</p>

<p><strong>Exercise 2</strong></p>

<p>Update reaction rule for ligand-receptor binding from</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">BoundTP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_T_phos</span><span class="o">*</span><span class="mf">0.2</span>
</code></pre></div></div>
<p>to</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">BoundTP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_T_phos</span><span class="o">*</span><span class="mi">5</span>
</code></pre></div></div>

<p>The complete code (you can download a completed BioNetGen file here: <a href="../_pages/chemotaxis/solutions_folder/exercise_repel.bngl" download="exercise_repel.bngl">exercise_repel.bngl</a>):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span> <span class="n">model</span>

<span class="k">begin</span> <span class="n">molecule</span> <span class="n">types</span>
	<span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>             <span class="c1">#ligand molecule</span>
	<span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>    <span class="c1">#receptor complex</span>
	<span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheZ</span><span class="p">()</span>
<span class="k">end</span> <span class="n">molecule</span> <span class="n">types</span>

<span class="k">begin</span> <span class="n">parameters</span>
	<span class="no">NaV2</span> <span class="mf">6.02e8</span>   <span class="c1">#Unit conversion to cellular concentration M/L -&gt; #/um^3</span>
	<span class="no">L0</span> <span class="mf">5e3</span>          <span class="c1">#number of ligand molecules</span>
	<span class="no">T0</span> <span class="mi">7000</span>       <span class="c1">#number of receptor complexes</span>
	<span class="no">CheY0</span> <span class="mi">20000</span>
	<span class="no">CheZ0</span> <span class="mi">6000</span>
	
	<span class="n">k_lr_bind</span> <span class="mf">8.8e6</span><span class="o">/</span><span class="no">NaV2</span>   <span class="c1">#ligand-receptor binding</span>
	<span class="n">k_lr_dis</span> <span class="mi">35</span>            <span class="c1">#ligand-receptor dissociation</span>
	<span class="n">k_T_phos</span> <span class="mi">15</span>            <span class="c1">#receptor complex autophosphorylation</span>
	<span class="n">k_Y_phos</span> <span class="mf">3.8e6</span><span class="o">/</span><span class="no">NaV2</span>    <span class="c1">#receptor complex phosphorylates Y</span>
	<span class="n">k_Y_dephos</span> <span class="mf">8.6e5</span><span class="o">/</span><span class="no">NaV2</span>  <span class="c1">#Z dephosphoryaltes Y</span>
<span class="k">end</span> <span class="n">parameters</span>

<span class="k">begin</span> <span class="n">reaction</span> <span class="n">rules</span>
	<span class="no">LR</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
	
	<span class="c1">#Free vs. ligand-bound receptor complexes autophosphorylates at different rates</span>
	<span class="no">FreeTP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_T_phos</span>
	<span class="no">BoundTP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_T_phos</span><span class="o">*</span><span class="mi">5</span>
	
	<span class="no">YP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Y_phos</span>
	<span class="no">YDeps</span><span class="p">:</span> <span class="no">CheZ</span><span class="p">()</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">CheZ</span><span class="p">()</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="n">k_Y_dephos</span>
<span class="k">end</span> <span class="n">reaction</span> <span class="n">rules</span>

<span class="k">begin</span> <span class="n">seed</span> <span class="n">species</span>
	<span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="no">L0</span>
	<span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.8</span>
	<span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.2</span>
	<span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="no">CheZ</span><span class="p">()</span> <span class="no">CheZ0</span>
<span class="k">end</span> <span class="n">seed</span> <span class="n">species</span>

<span class="k">begin</span> <span class="n">observables</span>
	<span class="no">Molecules</span> <span class="n">phosphorylated_CheY</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">phosphorylated_CheA</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">bound_ligand</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span> <span class="n">observables</span>

<span class="k">end</span> <span class="n">model</span>

<span class="n">generate_network</span><span class="p">({</span><span class="n">overwrite</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">})</span>
<span class="n">simulate</span><span class="p">({</span><span class="nb">method</span><span class="o">=&gt;</span><span class="s2">"ssa"</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=&gt;</span><span class="mi">100</span><span class="p">})</span>
</code></pre></div></div>

<p>The simulation outputs:
<img src="../_pages/chemotaxis/solutions_folder/exercise_repel.png" alt="image-center" class="align-center" /></p>

<h2 id="what-if-there-are-multiple-attractant-sources">What if there are multiple attractant sources?</h2>

<p><strong>Exercise 1:</strong></p>

<p>In <code class="language-plaintext highlighter-rouge">molecule types</code> and <code class="language-plaintext highlighter-rouge">observables</code>, update <code class="language-plaintext highlighter-rouge">L(t)</code> and <code class="language-plaintext highlighter-rouge">T(l,r,Meth~A~B~C,Phos~U~P)</code> to <code class="language-plaintext highlighter-rouge">L(t,Lig~A~B)</code> and <code class="language-plaintext highlighter-rouge">T(l,r,Lig~A~B,Meth~A~B~C,Phos~U~P)</code>, where <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> represent the two ligand types. Update the reaction rule</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">LR</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
</code></pre></div></div>

<p>to</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">L1R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
<span class="no">L2R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
</code></pre></div></div>

<p>Also update the <code class="language-plaintext highlighter-rouge">seed species</code> by equally split the initial receptor concentrations by 2.</p>

<p>You can download a completed BioNetGen file here: <a href="../_pages/chemotaxis/solutions_folder/exercise_twoligand.bngl" download="exercise_twoligand.bngl">exercise_twoligand.bngl</a>.</p>

<p><strong>Exercise 2:</strong></p>

<p>To wait for adaptation to ligand <code class="language-plaintext highlighter-rouge">A</code>, we could replace the forward reaction rate with this rule: rate constant = 0 unless after adapting to <code class="language-plaintext highlighter-rouge">A</code>. We could run the simulation without <code class="language-plaintext highlighter-rouge">B</code> first and observe the equilibrium methylation states, and use this for deciding whether the cell is adapted to <code class="language-plaintext highlighter-rouge">A</code>. (Why not equilibrium concentrations of free <code class="language-plaintext highlighter-rouge">A</code>?) One possible implementation is the following: replace</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">L1R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
<span class="no">L2R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
</code></pre></div></div>

<p>with</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">L1R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
<span class="no">L2R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="n">l2rate</span><span class="p">(),</span> <span class="n">k_lr_dis</span>
</code></pre></div></div>

<p>and <code class="language-plaintext highlighter-rouge">l2rate()</code> is a function defined as (remember to define it before <code class="language-plaintext highlighter-rouge">reaction rules</code>)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span> <span class="n">functions</span>
	<span class="n">l2rate</span><span class="p">()</span> <span class="o">=</span> <span class="k">if</span><span class="p">(</span><span class="n">high_methyl_receptor</span><span class="o">&gt;</span><span class="mf">1.2e3</span><span class="p">,</span><span class="n">k_lr_bind</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">end</span> <span class="n">functions</span>
</code></pre></div></div>

<p>The complete code:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span> <span class="n">model</span>

<span class="k">begin</span> <span class="n">compartments</span>
  <span class="no">EC</span>  <span class="mi">3</span>  <span class="mi">100</span>       <span class="c1">#um^3</span>
  <span class="no">PM</span>  <span class="mi">2</span>  <span class="mi">1</span>   <span class="no">EC</span>    <span class="c1">#um^2</span>
  <span class="no">CP</span>  <span class="mi">3</span>  <span class="mi">1</span>   <span class="no">PM</span>    <span class="c1">#um^3</span>
<span class="k">end</span> <span class="n">compartments</span>

<span class="k">begin</span> <span class="n">molecule</span> <span class="n">types</span>
	<span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="o">~</span><span class="no">B</span><span class="p">)</span>
	<span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="o">~</span><span class="no">B</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheZ</span><span class="p">()</span>
	<span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span> <span class="n">molecule</span> <span class="n">types</span>

<span class="k">begin</span> <span class="n">observables</span>
	<span class="no">Molecules</span> <span class="n">bound_ligand</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">phosphorylated_CheY</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">low_methyl_receptor</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">medium_methyl_receptor</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">high_methyl_receptor</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span>
	<span class="no">Molecules</span> <span class="n">phosphorylated_CheB</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span>
<span class="k">end</span> <span class="n">observables</span>

<span class="k">begin</span> <span class="n">parameters</span>
	<span class="no">NaV2</span> <span class="mf">6.02e8</span>   <span class="c1">#Unit conversion to cellular concentration M/L -&gt; #/um^3</span>
	<span class="n">miu</span> <span class="mf">1e-6</span>
	
	<span class="no">L0</span> <span class="mf">1e6</span>
	<span class="no">T0</span> <span class="mi">7000</span>
	<span class="no">CheY0</span> <span class="mi">20000</span>
	<span class="no">CheZ0</span> <span class="mi">6000</span>
	<span class="no">CheR0</span> <span class="mi">120</span>
	<span class="no">CheB0</span> <span class="mi">250</span>
	
	<span class="n">k_lr_bind</span> <span class="mf">8.8e6</span><span class="o">/</span><span class="no">NaV2</span>   <span class="c1">#ligand-receptor binding</span>
	<span class="n">k_lr_dis</span> <span class="mi">35</span>            <span class="c1">#ligand-receptor dissociation</span>
	
	<span class="n">k_TaUnbound_phos</span> <span class="mf">7.5</span>   <span class="c1">#receptor complex autophosphorylation</span>
	
	<span class="n">k_Y_phos</span> <span class="mf">3.8e6</span><span class="o">/</span><span class="no">NaV2</span>    <span class="c1">#receptor complex phosphorylates Y</span>
	<span class="n">k_Y_dephos</span> <span class="mf">8.6e5</span><span class="o">/</span><span class="no">NaV2</span>  <span class="c1">#Z dephosphoryaltes Y</span>
	
	<span class="n">k_TR_bind</span> <span class="mf">2e7</span><span class="o">/</span><span class="no">NaV2</span>          <span class="c1">#Receptor-CheR binding</span>
	<span class="n">k_TR_dis</span>  <span class="mi">1</span>            <span class="c1">#Receptor-CheR dissociaton</span>
	<span class="n">k_TaR_meth</span> <span class="mf">0.08</span>        <span class="c1">#CheR methylates receptor complex</span>
	
	<span class="n">k_B_phos</span> <span class="mf">1e5</span><span class="o">/</span><span class="no">NaV2</span>      <span class="c1">#CheB phosphorylation by receptor complex</span>
	<span class="n">k_B_dephos</span> <span class="mf">0.17</span>        <span class="c1">#CheB autodephosphorylation</span>
	
	<span class="n">k_Tb_demeth</span> <span class="mf">5e4</span><span class="o">/</span><span class="no">NaV2</span>   <span class="c1">#CheB demethylates receptor complex</span>
	<span class="n">k_Tc_demeth</span> <span class="mf">2e4</span><span class="o">/</span><span class="no">NaV2</span>   <span class="c1">#CheB demethylates receptor complex</span>
<span class="k">end</span> <span class="n">parameters</span>

<span class="k">begin</span> <span class="n">functions</span>
	<span class="n">l2rate</span><span class="p">()</span> <span class="o">=</span> <span class="k">if</span><span class="p">(</span><span class="n">high_methyl_receptor</span><span class="o">&gt;</span><span class="mf">1.2e3</span><span class="p">,</span><span class="n">k_lr_bind</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">end</span> <span class="n">functions</span>

<span class="k">begin</span> <span class="n">reaction</span> <span class="n">rules</span>
	<span class="no">L1R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="n">k_lr_bind</span><span class="p">,</span> <span class="n">k_lr_dis</span>
	<span class="no">L2R</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="n">l2rate</span><span class="p">(),</span> <span class="n">k_lr_dis</span>
	<span class="c1">#L3R: L(t,Lig~T) + T(l,Lig~O) &lt;-&gt; L(t!1,Lig~O).T(l!1,Lig~O) l2rate(), k_lr_dis</span>
	
	<span class="c1">#Receptor complex (specifically CheA) autophosphorylation</span>
	<span class="c1">#Rate dependent on methylation and binding states</span>
	<span class="c1">#Also on free vs. bound with ligand</span>
	<span class="no">TaUnboundP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span>
	<span class="no">TbUnboundP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">1.1</span>
	<span class="no">TcUnboundP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">2.8</span>
	<span class="no">TaLigandP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="mi">0</span>
	<span class="no">TbLigandP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">0.8</span>
	<span class="no">TcLigandP</span><span class="p">:</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">T</span><span class="p">(</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_TaUnbound_phos</span><span class="o">*</span><span class="mf">1.6</span>
	
	<span class="c1">#CheY phosphorylation by T and dephosphorylation by CheZ</span>
	<span class="no">YP</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Y_phos</span>
	<span class="no">YDep</span><span class="p">:</span> <span class="no">CheZ</span><span class="p">()</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">CheZ</span><span class="p">()</span> <span class="o">+</span> <span class="no">CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="n">k_Y_dephos</span>
	
	<span class="c1">#CheR binds to and methylates receptor complex</span>
	<span class="c1">#Rate dependent on methylation states and ligand binding</span>
	<span class="no">TRBind</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="n">k_TR_bind</span><span class="p">,</span> <span class="n">k_TR_dis</span>
	<span class="no">TaRUnboundMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span>
	<span class="no">TbRUnboundMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span><span class="o">*</span><span class="mf">0.1</span>
	<span class="no">TaRLigandMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span><span class="o">*</span><span class="mi">30</span>
	<span class="no">TbRLigandMeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="n">r!</span><span class="mi">2</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">CheR</span><span class="p">(</span><span class="n">t!</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l!</span><span class="mi">1</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span><span class="o">.</span><span class="no">L</span><span class="p">(</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="n">k_TaR_meth</span><span class="o">*</span><span class="mi">3</span>
	
	<span class="c1">#CheB is phosphorylated by receptor complex, and autodephosphorylates</span>
	<span class="no">CheBphos</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_B_phos</span>
	<span class="no">CheBdephos</span><span class="p">:</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="n">k_B_dephos</span>
	
	<span class="c1">#CheB demethylates receptor complex</span>
	<span class="c1">#Rate dependent on methyaltion states</span>
	<span class="no">TbDemeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Tb_demeth</span>
	<span class="no">TcDemeth</span><span class="p">:</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="no">T</span><span class="p">(</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="o">+</span> <span class="no">CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="n">k_Tc_demeth</span>
	
<span class="k">end</span> <span class="n">reaction</span> <span class="n">rules</span>

<span class="k">begin</span> <span class="n">seed</span> <span class="n">species</span>
	<span class="vi">@EC</span><span class="ss">:L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">)</span> <span class="no">L0</span>
	<span class="vi">@EC</span><span class="ss">:L</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">)</span> <span class="no">L0</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.84</span><span class="o">*</span><span class="mf">0.9</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.15</span><span class="o">*</span><span class="mf">0.9</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.01</span><span class="o">*</span><span class="mf">0.9</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.84</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.15</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.01</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.84</span><span class="o">*</span><span class="mf">0.9</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.15</span><span class="o">*</span><span class="mf">0.9</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.01</span><span class="o">*</span><span class="mf">0.9</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">A</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.84</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.15</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@PM</span><span class="ss">:T</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="no">Lig</span><span class="o">~</span><span class="no">B</span><span class="p">,</span><span class="no">Meth</span><span class="o">~</span><span class="no">C</span><span class="p">,</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">T0</span><span class="o">*</span><span class="mf">0.01</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">0.5</span>
	<span class="vi">@CP</span><span class="ss">:CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.71</span>
	<span class="vi">@CP</span><span class="ss">:CheY</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheY0</span><span class="o">*</span><span class="mf">0.29</span>
	<span class="vi">@CP</span><span class="ss">:CheZ</span><span class="p">()</span> <span class="no">CheZ0</span>
	<span class="vi">@CP</span><span class="ss">:CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">U</span><span class="p">)</span> <span class="no">CheB0</span><span class="o">*</span><span class="mf">0.62</span>
	<span class="vi">@CP</span><span class="ss">:CheB</span><span class="p">(</span><span class="no">Phos</span><span class="o">~</span><span class="no">P</span><span class="p">)</span> <span class="no">CheB0</span><span class="o">*</span><span class="mf">0.38</span>
	<span class="vi">@CP</span><span class="ss">:CheR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="no">CheR0</span>
<span class="k">end</span> <span class="n">seed</span> <span class="n">species</span>

<span class="k">end</span> <span class="n">model</span>

<span class="n">generate_network</span><span class="p">({</span><span class="n">overwrite</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">})</span>
<span class="n">simulate</span><span class="p">({</span><span class="nb">method</span><span class="o">=&gt;</span><span class="s2">"ssa"</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=&gt;</span><span class="mi">700</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=&gt;</span><span class="mi">400</span><span class="p">})</span>
</code></pre></div></div>

<p>The simulation outputs:
<img src="../_pages/chemotaxis/solutions_folder/exercise_twoligand_figure.png" alt="image-center" class="align-center" /></p>

<p><strong>Exercise 3:</strong></p>

<p>Define <code class="language-plaintext highlighter-rouge">ligand_center1 = [1500, 1500]</code> and <code class="language-plaintext highlighter-rouge">ligand_center2 = [-1500, 1500]</code>. Since we are considering two gradients, we can add up the ligand concentration. We can replace our <code class="language-plaintext highlighter-rouge">cal_concentraion(pos)</code> function with</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calc_concentration</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="n">dist1</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ligand_center1</span><span class="p">)</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ligand_center2</span><span class="p">)</span>

    <span class="n">exponent1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dist1</span> <span class="o">/</span> <span class="n">origin_to_center</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">center_exponent</span> <span class="o">-</span> <span class="n">start_exponent</span><span class="p">)</span> <span class="o">+</span> <span class="n">start_exponent</span>
    <span class="n">exponent2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dist2</span> <span class="o">/</span> <span class="n">origin_to_center</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">center_exponent</span> <span class="o">-</span> <span class="n">start_exponent</span><span class="p">)</span> <span class="o">+</span> <span class="n">start_exponent</span>
    
    <span class="k">return</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exponent1</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exponent2</span>
</code></pre></div></div>

<h2 id="is-the-actual-tumbling-reorientation-used-by-e-coli-smarter-than-our-model">Is the actual tumbling reorientation used by E. coli smarter than our model?</h2>

<p>Now, for sampling the new direction, we need to consider the past concentration and the current concentration the bacterium experiences. Since the new direction is also dependent on the last direction, we also need to record the current directions.</p>

<p>Therefore, for our <code class="language-plaintext highlighter-rouge">tumble_move()</code> function, we would consider three inputs: <code class="language-plaintext highlighter-rouge">curr_direction, curr_conc, past_conc</code>. If the current concentration is higher than the past concentration, we sample the turning with mean of 1.19Ï€-0.1Ï€=1.09Ï€ and standard deviation of 0.63Ï€; otherwise ample the turning with mean of 1.19Ï€ and standard deviation of 0.63Ï€. The new direction is the sum of the turning and the past direction.</p>

<p>Add the mean and standard deviation of turning as constants.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Constants for E.coli tumbling
</span><span class="n">tumble_angle_mu</span> <span class="o">=</span> <span class="mf">1.19</span>
<span class="n">tumble_angle_std</span> <span class="o">=</span> <span class="mf">0.63</span>
</code></pre></div></div>

<p>We implement the <code class="language-plaintext highlighter-rouge">tumble_move</code> function as the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">tumble_move</span><span class="p">(</span><span class="n">curr_dir</span><span class="p">,</span> <span class="n">curr_conc</span><span class="p">,</span> <span class="n">past_conc</span><span class="p">):</span>
    <span class="c1">#Sample the new direction
</span>    <span class="n">corrent</span> <span class="o">=</span> <span class="n">curr_conc</span> <span class="o">&gt;</span> <span class="n">past_conc</span>
    
    <span class="k">if</span> <span class="n">correct</span><span class="p">:</span>
        <span class="n">new_dir</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="n">tumble_angle_mu</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">tumble_angle_std</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_dir</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="n">tumble_angle_mu</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">tumble_angle_std</span><span class="p">)</span>
    <span class="n">new_dir</span> <span class="o">*=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">new_dir</span> <span class="o">+=</span> <span class="n">curr_dir</span>
    
    <span class="n">new_dir</span> <span class="o">=</span> <span class="n">new_dir</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span> <span class="c1">#keep within [0, 2pi]
</span>        
    <span class="n">projection_h</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span> <span class="c1">#Horizontal displacement for next run
</span>    <span class="n">projection_v</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span> <span class="c1">#Vertical displacement for next run
</span>    
    <span class="n">tumble_time</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">tumble_time_mu</span><span class="p">)</span> <span class="c1">#Length of the tumbling
</span>    
    <span class="k">return</span> <span class="n">new_dir</span><span class="p">,</span> <span class="n">projection_h</span><span class="p">,</span> <span class="n">projection_v</span><span class="p">,</span> <span class="n">tumble_time</span>
</code></pre></div></div>

<p>Update the <code class="language-plaintext highlighter-rouge">simulate</code> function by replacing</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">projection_h</span><span class="p">,</span> <span class="n">projection_v</span><span class="p">,</span> <span class="n">tumble_time</span> <span class="o">=</span> <span class="n">tumble_move</span><span class="p">()</span>
</code></pre></div></div>

<p>with</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">curr_direction</span><span class="p">,</span> <span class="n">projection_h</span><span class="p">,</span> <span class="n">projection_v</span><span class="p">,</span> <span class="n">tumble_time</span> <span class="o">=</span> <span class="n">tumble_move</span><span class="p">(</span><span class="n">curr_direction</span><span class="p">,</span> <span class="n">curr_conc</span><span class="p">,</span> <span class="n">past_conc</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="cant-get-enough-bionetgen">Canâ€™t get enough BioNetGen?</h2>

<p><strong>Exercise 1:</strong>
You should know the molecules involved (<code class="language-plaintext highlighter-rouge">molecule types</code>), reactions and reaction rate constants (<code class="language-plaintext highlighter-rouge">reaction rules</code>), the initial conditions (<code class="language-plaintext highlighter-rouge">seed species</code>), the quantities you are interested in observing (<code class="language-plaintext highlighter-rouge">observables</code>), your simulation methods and time steps. Compartments and parameters should also be considered if applicable.</p>

<p><strong>Exercise 2:</strong>
The complete code (you can download a completed BioNetGen file here: <a href="../_pages/chemotaxis/solutions_folder/exercise_polymorization.bngl" download="exercise_polymerization.bngl">exercise_polymerization.bngl</a>):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span> <span class="n">model</span>

<span class="k">begin</span> <span class="n">molecule</span> <span class="n">types</span>
	<span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span> <span class="n">molecule</span> <span class="n">types</span>

<span class="k">begin</span> <span class="n">reaction</span> <span class="n">rules</span>
	<span class="no">Initiation</span><span class="p">:</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span>
	<span class="no">Polymerizationfree</span><span class="p">:</span> <span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="o">+</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="o">+</span><span class="p">,</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span>
	<span class="no">Polymerizationfree2</span><span class="p">:</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t!</span><span class="o">+</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="mi">1</span><span class="p">,</span><span class="n">t!</span><span class="o">+</span><span class="p">)</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span>
	<span class="no">Polymerizationbound</span><span class="p">:</span> <span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="o">+</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t!</span><span class="o">+</span><span class="p">)</span> <span class="o">&lt;-&gt;</span> <span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="o">+</span><span class="p">,</span><span class="n">t!</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="no">A</span><span class="p">(</span><span class="n">h!</span><span class="mi">1</span><span class="p">,</span><span class="n">t!</span><span class="o">+</span><span class="p">)</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span>
<span class="k">end</span> <span class="n">reaction</span> <span class="n">rules</span>

<span class="k">begin</span> <span class="n">seed</span> <span class="n">species</span>
	<span class="no">A</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="mi">1000</span>
<span class="k">end</span> <span class="n">seed</span> <span class="n">species</span>

<span class="k">begin</span> <span class="n">observables</span>
	<span class="no">Species</span> <span class="no">A1</span> <span class="no">A</span><span class="o">==</span><span class="mi">1</span>
	<span class="no">Species</span> <span class="no">A2</span> <span class="no">A</span><span class="o">==</span><span class="mi">2</span>
	<span class="no">Species</span> <span class="no">A3</span> <span class="no">A</span><span class="o">==</span><span class="mi">3</span>
	<span class="no">Species</span> <span class="no">A5</span> <span class="no">A</span><span class="o">==</span><span class="mi">5</span>
	<span class="no">Species</span> <span class="no">A10</span> <span class="no">A</span><span class="o">==</span><span class="mi">10</span>
	<span class="no">Species</span> <span class="no">A20</span> <span class="no">A</span><span class="o">==</span><span class="mi">20</span>
	<span class="no">Species</span> <span class="no">ALong</span> <span class="no">A</span><span class="o">&gt;=</span><span class="mi">30</span>
<span class="k">end</span> <span class="n">observables</span>

<span class="k">end</span> <span class="n">model</span>

<span class="n">simulate</span><span class="p">({</span><span class="nb">method</span><span class="o">=&gt;</span><span class="s2">"nf"</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=&gt;</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=&gt;</span><span class="mi">1000</span><span class="p">})</span>
</code></pre></div></div>

<p>The simulation outputs (note the concentrations are in log-scale):
<img src="../_pages/chemotaxis/solutions_folder/exercise_polymorization_figure_log.png" alt="image-center" class="align-center" /></p>

<h2 id="how-to-calculate-steady-state-concentration-in-a-reversible-bimolecular-reaction">How to calculate steady state concentration in a reversible bimolecular reaction?</h2>

<p><strong>Exercise 1:</strong>
When the reaction begins, concentrations change toward the equilibrium concentrations. The system remains at the equilibrium state once reaching it.</p>

<p><strong>Exercise 2:</strong>
Use [<em>A</em>], [<em>B</em>], [<em>AB</em>] to denote the equilibrium concentrations. At equilibrium concentrations, we have</p>

<p><em>k</em><sub>bind</sub> Â· [<em>A</em>] Â· [<em>B</em>] = <em>k</em><sub>dissociate</sub> Â· [<em>AB</em>].</p>

<p>Because of conservation of mass, if the instead starts from no <em>AB</em>, our initial conditions will be <em>a<sub>0</sub></em> = <em>b<sub>0</sub></em> = 100, and <em>ab<sub>0</sub></em> = 0. (If we instead work from the â€œcurrentâ€ concentrations, <em>a<sub>0</sub></em> = <em>b<sub>0</sub></em> = 95, and <em>ab<sub>0</sub></em> = 5, how would you set up the calculations?)</p>

<p>Similar as in the main text, Our original steady state equation can be modified to</p>

<p><em>k</em><sub>bind</sub> Â· (<em>a</em><sub>0</sub> - [<em>AB</em>]) Â· (<em>b</em><sub>0</sub> - [<em>AB</em>]) = <em>k</em><sub>dissociate</sub> Â· [<em>AB</em>].</p>

<p>Solving this equation yields [<em>AB</em>] = 90.488.</p>

<p><strong>Exercise 3:</strong>
If we add additional 100 <em>A</em> molecules to the system, more <em>AB</em> will be formed. If you use the equation setup in the solution above, we can simply update <em>a</em><sub>0</sub> = 200. [<em>AB</em>] = 99.019.</p>

<p>If <em>k</em><sub>dissociate</sub> = 9 instead of 3, less <em>AB</em> will be present at the equilibirum state. [<em>AB</em>] = 84.115.</p>

<h2 id="how-to-simulate-a-reaction-step-with-the-gillespie-algorithm">How to simulate a reaction step with the Gillespie algorithm?</h2>

<p><strong>Exercise 1:</strong> 
Shorter because molecules collide to each other and react more frequently.</p>

<p><strong>Exercise 2:</strong>
In this system, we have Î» = 100. The probability that exactly 100 reaction happen in the next second is</p>

\[\mathrm{Pr}(X = 100) = \dfrac{\lambda^n e^{-\lambda}}{n!} = 0.03986\,.\]

<p>The expected wait time is 1/Î» = 0.01.</p>

<p>The probability that the first reaction occur after 0.02 second is</p>

\[\mathrm{Pr}(T &gt; 0.02) = e^{-\lambda t} = 0.1353\,.\]

<p><strong>Exercise 3:</strong>
At the beginning of the simulation, only one type of reaction could occur: <em>L</em> + <em>T</em> â†’ <em>LT</em>. The rate of reaction is <em>k</em><sub>bind</sub>[<em>L</em>][<em>T</em>] = 100moleculeÂ·s<sup>-1</sup>. Therefore we have Î» = 100moleculeÂ·s<sup>-1</sup>, and the expected wait time is thus 1/Î» = 0.01sÂ·molecule<sup>-1</sup>.</p>

<p>Although the expected wait time before the first reaction is considerably shorter than 0.1s, it is still possible for the first reaction to happen after 0.1s.</p>

<p>After the first reaction, our system has 9 <em>L</em>, 9 <em>T</em>, and 1 <em>LT</em> molecules. There are two possible types of reactions to occur: the forward reaction <em>L</em> + <em>T</em> â†’ <em>LT</em> and the reverse reaction <em>LT</em> â†’ <em>L</em> + <em>T</em>. The rate of forward reaction is <em>k</em><sub>bind</sub>[<em>L</em>][<em>T</em>] = 81moleculeÂ·s<sup>-1</sup>, while the rate of reverse reaction is <em>k</em><sub>dissociate</sub>[<em>LT</em>] = 2moleculeÂ·s<sup>-1</sup>. The total reaction rate is 83moleculeÂ·s<sup>-1</sup> and hence the expected wait time before the next reaction is 0.012s. The probability of forward reaction is 81moleculeÂ·s<sup>-1</sup>/83moleculeÂ·s<sup>-1</sup> = 0.976, and the probability of reverse reaction is 0.0241.</p>


        
      </section>

      <footer class="page__meta">
        
        


        

      </footer>

      

      
    </div>

    
  </article>

  <!-- only show related on a post page when `related: true`
  
  
  -->
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <hr>
  <a href="http://cbd.cmu.edu" target="_blank"><img align = "left" src="/biological_modeling_course/assets/images/combined_SCS_Unitmark_187_K.jpg" alt="CBD Logo" width="40%" height="40%"></a>
  <a href="http://mmbios.pitt.edu" target="_blank"><img align="right" src="/biological_modeling_course/assets/images/MMBioS_Logo.png" alt="MMBioS Logo" width="50%" height="50%"></a>
</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
